{% extends 'layout.html' %}
{% block content %}
<h2>Edit Game</h2>
<div class="card">
  <form method="post">
    {% csrf_token %}
    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div>
        <h3 style="margin-top:0">{{ game.team1.name }}</h3>
      </div>
      <div>
        <h3 style="margin-top:0">{{ game.team2.name }}</h3>
      </div>
    </div>
    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div class="form-row">
        <label class="muted">Team 1 Score</label>
        <input type="number" name="team1_score" value="{{ game.team1_score|default_if_none:'' }}" min="0">
      </div>
      <div class="form-row">
        <label class="muted">Team 2 Score</label>
        <input type="number" name="team2_score" value="{{ game.team2_score|default_if_none:'' }}" min="0">
      </div>
    </div>
    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div class="form-row">
        <label class="muted">Date/Time</label>
        <input type="datetime-local" name="starts_at" value="{{ game.starts_at|default_if_none:''|date:'Y-m-d\\TH:i' }}">
      </div>
      <div class="form-row">
        <label class="muted">Location</label>
        <input type="text" name="location" value="{{ game.location|default_if_none:'' }}">
      </div>
    </div>
    <div class="form-row">
      <label><input type="checkbox" name="is_final" {% if game.is_final %}checked{% endif %}> Final</label>
    </div>

    <h3>Player Stats</h3>
    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 1rem;">
      <div>
        <h4>{{ game.team1.name }}</h4>
        <table>
          <thead>
            <tr><th>#</th><th>Name</th><th>G</th><th>A</th><th>S</th><th>PIM</th><th>+/-</th></tr>
          </thead>
          <tbody>
            {% for row in team1_rows %}
              {% with p=row.player s=row.stats %}
              <tr>
                <td>{{ p.jersey_number|default_if_none:'' }}</td>
                <td>{{ p.name }}</td>
                <td><input type="number" name="ps_goals_{{ p.id }}" value="{{ s.goals|default_if_none:'' }}" min="0" style="width:80px"></td>
                <td><input type="number" name="ps_assists_{{ p.id }}" value="{{ s.assists|default_if_none:'' }}" min="0" style="width:80px"></td>
                <td><input type="number" name="ps_shots_{{ p.id }}" value="{{ s.shots|default_if_none:'' }}" min="0" style="width:80px"></td>
                <td><input type="number" name="ps_pim_{{ p.id }}" value="{{ s.pim|default_if_none:'' }}" min="0" style="width:80px"></td>
                <td><input type="number" name="ps_plusminus_{{ p.id }}" value="{{ s.plus_minus|default_if_none:'' }}" style="width:80px"></td>
              </tr>
              {% endwith %}
            {% empty %}
              <tr><td colspan="7" class="muted">No players</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div>
        <h4>{{ game.team2.name }}</h4>
        <table>
          <thead>
            <tr><th>#</th><th>Name</th><th>G</th><th>A</th><th>S</th><th>PIM</th><th>+/-</th></tr>
          </thead>
          <tbody>
            {% for row in team2_rows %}
              {% with p=row.player s=row.stats %}
              <tr>
                <td>{{ p.jersey_number|default_if_none:'' }}</td>
                <td>{{ p.name }}</td>
                <td><input type="number" name="ps_goals_{{ p.id }}" value="{{ s.goals|default_if_none:'' }}" min="0" style="width:80px"></td>
                <td><input type="number" name="ps_assists_{{ p.id }}" value="{{ s.assists|default_if_none:'' }}" min="0" style="width:80px"></td>
                <td><input type="number" name="ps_shots_{{ p.id }}" value="{{ s.shots|default_if_none:'' }}" min="0" style="width:80px"></td>
                <td><input type="number" name="ps_pim_{{ p.id }}" value="{{ s.pim|default_if_none:'' }}" min="0" style="width:80px"></td>
                <td><input type="number" name="ps_plusminus_{{ p.id }}" value="{{ s.plus_minus|default_if_none:'' }}" style="width:80px"></td>
              </tr>
              {% endwith %}
            {% empty %}
              <tr><td colspan="7" class="muted">No players</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div style="margin-top:1rem;">
      <button class="btn primary" type="submit">Save</button>
      <a class="btn" href="/schedule">Back</a>
    </div>
  </form>
</div>
{% endblock %}
