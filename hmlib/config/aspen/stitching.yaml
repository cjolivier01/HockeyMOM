aspen:
  # Keep the context surface area small; only the keys requested by each
  # plugin (input_keys) plus shared are threaded between trunks.
  minimal_context: true

  # Minimal video-out pipeline for stitched panoramas. We avoid cropping and
  # camera-box logic here and only normalize images into a visible uint8
  # format for encoding.
  video_out_pipeline:
    - type: HmImageColorAdjust
      # No-op by default; runtime camera color tweaks can still be wired in
      # later via game_config if desired.
    - type: HmMakeVisibleImage

  plugins:
    stitching:
      class: hmlib.aspen.plugins.stitching_plugin.StitchingPlugin
      depends: []
      enabled: GLOBAL.aspen.stitching.enabled
      params:
        pto_project_file: GLOBAL.aspen.stitching.pto_project_file
        dir_name: GLOBAL.aspen.stitching.dir_name
        blend_mode: GLOBAL.aspen.stitching.blend_mode
        max_blend_levels: GLOBAL.aspen.stitching.max_blend_levels
        auto_adjust_exposure: GLOBAL.aspen.stitching.auto_adjust_exposure
        python_blender: GLOBAL.aspen.stitching.python_blender
        minimize_blend: GLOBAL.aspen.stitching.minimize_blend
        dtype: GLOBAL.aspen.stitching.dtype
        no_cuda_streams: GLOBAL.aspen.stitching.no_cuda_streams
        post_stitch_rotate_degrees: GLOBAL.aspen.stitching.post_stitch_rotate_degrees
        left_color_pipeline: GLOBAL.aspen.left_stitch_pipeline
        right_color_pipeline: GLOBAL.aspen.right_stitch_pipeline
        capture_rgb_stats: GLOBAL.aspen.stitching.capture_rgb_stats
        max_output_width: GLOBAL.aspen.stitching.max_output_width

    apply_camera:
      class: hmlib.camera.apply_camera_plugin.ApplyCameraPlugin
      depends: [stitching]
      enabled: true
      params:
        # Inline the pipeline here so this config is self-contained and
        # does not depend on GLOBAL.* references.
        video_out_pipeline:
          - type: HmImageColorAdjust
          - type: HmMakeVisibleImage
        # For stitching we always keep the full panorama.
        crop_output_image: false
        crop_play_box: false
        end_zones: false

    video_out:
      class: hmlib.aspen.plugins.video_out_plugin.VideoOutPlugin
      depends: [apply_camera]
      enabled: true
      params:
        # output_video_path, skip_final_save and save_frame_dir are wired
        # in programmatically from the CLI (stitch.py) before AspenNet
        # is constructed.
        cache_size: 2
        bit_rate: GLOBAL.aspen.video_out.bit_rate
        output_width: GLOBAL.aspen.video_out.output_width
        output_height: GLOBAL.aspen.video_out.output_height
        show_image: GLOBAL.aspen.video_out.show_image
        show_scaled: GLOBAL.aspen.video_out.show_scaled
